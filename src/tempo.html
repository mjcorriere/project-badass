<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>

    <script src="underscore.js" type="text/javascript"></script>    
    <canvas id="render-window" width="578" height="200" style="border:1px dotted;float:left"></canvas>
    <script>

        window.requestAnimFrame = (function(callback) 
        {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame 
            || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
            function(callback) {
                window.setTimeout(callback, 1000 / 60);
            };
        })();

        function sigh(rgb)
        {
            return 'rgb(' + rgb.join(',') + ')';
        }

        function drawParticle(particle, context)
        {
            context.beginPath();

            context.fillStyle=sigh(particle.style.color);
            context.arc(particle.x, particle.y, particle.radius, 2 * Math.PI, false);

            context.fill();
        }

        var
            particles = [
                { x : 100, y : 150, radius : 10, style : { color : [128, 128, 128] } }, 
                { x : 20, y : 50, radius : 10, style : { color : [50, 0, 255] } } ],
            forces = [ { x : 0.01, y : 0.003 }, { x : .005, y : -0.001 }];

        function animate(particles, canvas, context, startTime) 
        {
            // update
            var time = (new Date()).getTime() - startTime;

            // clear
            context.clearRect(0, 0, canvas.width, canvas.height);

            // move it move it
            _.each(_.zip(particles, forces), function(particle_and_force)
            {
                var
                    particle = particle_and_force[0],
                    force = particle_and_force[1];

                particle.x += force.x * time;
                particle.y += force.y * time;
            });

            // draw it
            _.each(particles, function(particle) 
            {
                drawParticle(particle, context);
            });

            // request new frame
            requestAnimFrame(function() {
              animate(particles, canvas, context, startTime);
            });
        }

        var canvas = document.getElementById('render-window');
        var context = canvas.getContext('2d');

        // wait one second before starting animation
        setTimeout(function() 
        {
            var startTime = (new Date()).getTime();
            animate(particles, canvas, context, startTime);
        }, 1000);

    </script>
  </body>
</html>
